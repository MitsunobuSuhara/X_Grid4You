# X-Grid & X-Grid Styler 開発・リリース作業マニュアル【超完全版・改訂FINAL】

このマニュアルは、`X_Grid`アプリ本体と`X-Grid Styler` QGISプラグインの開発から、新しいバージョンの配布ファイルをGitHubにリリースするまでの一連の作業手順を、詳細にまとめたものです。よくあるトラブルシューティングも含まれています。

---

## Part 0: 初期セットアップ（PCごとに最初の一回だけ）

新しい開発環境を整える際に、最初に行うべき設定です。

### 1. Git LFS (Large File Storage) のインストール

-   **目的:** 25MBを超える大きなファイル（インストーラーなど）をGitHubにアップロードできるようにするためのGit拡張機能です。
-   **手順:**
    1.  [Git LFSの公式サイト](https://git-lfs.com/)からインストーラーをダウンロードし、インストールします。
    2.  ターミナル（PowerShellなど）を開き、以下のコマンドを一度だけ実行します。
        ```bash
        git lfs install
        ```

### 2. `.gitignore` ファイルの作成

-   **目的:** 不要なファイル（ビルド時の中間ファイル、仮想環境フォルダなど）をGitの管理対象から除外し、リポジトリを常にクリーンな状態に保つための設定ファイルです。
-   **手順:**
    1.  プロジェクトフォルダの**一番上の階層**に、`.gitignore` という名前のテキストファイルを作成します。（`.txt`などの拡張子が付かないように注意）
    2.  以下の内容をコピー＆ペーストして保存します。

        ```
        # Python
        __pycache__/
        *.pyc
        venv/
        
        # PyInstaller
        build/
        dist/
        *.spec
        
        # Inno Setup
        Output/
        *.iss
        
        # OS generated files
        .DS_Store
        Thumbs.db
        ```

### 3. Inno Setup のインストール

-   **目的:** PyInstallerで生成したファイル群を、単一で高圧縮な `.exe` 形式のインストーラーにまとめるためのツールです。
-   **手順:**
    1.  [Inno Setupの公式サイト](https://jrsoftware.org/isinfo.php)から安定版をダウンロードし、インストールします。

---

## Part 1: 開発とリリースのサイクル（更新ごとに行う作業）

ここからの手順は、アプリやプラグインを更新して、新しいバージョンをリリースするたびに繰り返し行います。

(ステップ1から3までは変更ありません)

### ステップ1: コードの編集とテスト
... (内容は省略) ...

### ステップ2: 配布ファイルのビルド
... (内容は省略) ...

### ステップ3: インストーラーの作成 (Inno Setup)
... (内容は省略) ...

### ステップ4: GitHubへのアップロード (Push)

1.  **変更内容の確認 (`git status`)**
    -   ターミナルで `git status` を実行し、変更・追加されたファイルを確認します。

2.  **すべての変更を追加 (`git add`)**
    -   `.gitignore` があるので、安全にすべての変更をステージングできます。
        ```powershell
        git add .
        ```

3.  **変更を記録 (`git commit`)**
    -   変更内容が分かるように、メモを付けてPC内に記録します。
        ```powershell
        git commit -m "feat: バージョン1.1.0の更新 (ここに具体的な変更内容を書く)"
        ```

4.  **GitHubに送信 (`git push`)**
    -   PC内の記録を、インターネット上のGitHubにアップロードします。
        ```powershell
        git push origin main
        ```

    -   **🚨【重要】`push`が失敗 (rejected) した場合の対処法**
        -   `error: failed to push...` というメッセージが表示されたら、それはあなたのPCが知らない変更が先にGitHubに存在するためです。慌てずに以下の手順に進んでください。

    -   **手順A: GitHubの最新の変更を取り込む (`git pull`)**
        ```powershell
        git pull origin main
        ```
        -   **成功した場合:** `Successfully merged...` のようなメッセージが出たら、競合はありませんでした。もう一度 `git push origin main` を実行して、ステップ5に進んでください。
        -   **コンフリクトが発生した場合:** `CONFLICT ...` `Automatic merge failed;` というメッセージが出たら、**手順B**に進んでください。

    -   **手順B: コンフリクト (競合) の解決**
        -   Gitが自動で統合できず、あなたの判断が必要な状態です。
        -   `git status` を実行すると、どのファイルが競合しているか (`Unmerged paths`) がわかります。
        -   競合したファイルごとに、**自分の変更を残すか、相手(GitHub)の変更を残すか**を決定し、以下のコマンドを実行します。

            -   **自分の変更を優先する場合 (例: 自分が削除したなら、削除を正とする)**
                ```powershell
                git checkout --ours "ファイル名"
                ```
            -   **相手(GitHub)の変更を優先する場合 (例: GitHub上の更新版を採用する)**
                ```powershell
                git checkout --theirs "ファイル名"
                ```
            *(例: `取扱説明書.pdf`が競合し、自分の「削除」を優先するなら `git rm 取扱説明書.pdf` を実行します)*

        -   競合ファイルをすべて解決したら、それをGitに伝えます。
            ```powershell
            # 変更を適用したファイルをaddする
            git add . 
            ```

        -   最後に、マージを完了させるためのコミットを実行します。
            ```powershell
            # このコマンドを実行するとエディタが開くので、何も変更せずに保存して閉じる
            git commit
            ```

        -   これでローカルの準備が整いました。満を持して、もう一度 `push` します。
            ```powershell
            git push origin main
            ```

### ステップ5: GitHubでのリリース作成（ファイル添付とリンク作成）

ここがリリースの最後の仕上げです。慎重に進めましょう。

1.  **リリース作成画面へ**
    -   ブラウザであなたのGitHubリポジトリを開き、右側の **[Releases]** > **[Draft a new release]** をクリックします。

2.  **基本情報の入力**
    -   **Tag version**: 新しいバージョン番号を入力します (例: `v1.1.0`)。
    -   **Release title**: リリースのタイトルを入力します (例: `X-Grid v1.1.0`)。

3.  **リリース内容の記述とリンク作成【最重要】**
    -   **"Describe this release"** のテキストエリアに、以下のテンプレートを**そのままコピー＆ペースト**してください。これがダウンロードリンクの元になります。

        ````markdown
        X-GridとQGISプラグインのバージョン1.1.0をリリースしました。

        ---

        ### このバージョンの主な変更点

        -   [修正] ポリゴンのスタイル読み込み時の不具合を修正しました。
        -   （ここに変更点を追記・修正してください）

        ---

        ### ⬇️ ダウンロードはこちらから ⬇️

        -   **X-Grid アプリ (インストーラー):** [X_Grid_v1.1.0_setup.exe](X_Grid_v1.1.0_setup.exe)
        -   **X-Grid Styler プラグイン (zip):** [x_grid_styler.zip](x_grid_styler.zip)
        -   **取扱説明書:** [取扱説明書.pdf](取扱説明書.pdf)

        ---

        ### インストール方法

        #### X-Grid (本体アプリ)
        1.  上のリンクから `X_Grid_v1.1.0_setup.exe` をダウンロードします。
        2.  ダウンロードしたファイルを実行し、画面の指示に従ってインストールします。

        #### X-Grid Styler (QGISプラグイン)
        1.  上のリンクから `x_grid_styler.zip` をダウンロードします。
        2.  QGISを起動し、メニューから `[プラグイン]` > `[プラグインの管理とインストール]` を開きます。
        3.  `[ZIPからインストール]` タブを選択し、ダウンロードした `x_grid_styler.zip` を指定してインストールします。

        ---
        *注: このページの一番下にある "Assets" は、開発者向けのソースコードです。通常の利用ではダウンロードする必要はありません。*
        ````
    -   💡 **リンクの仕組み:** `[表示したい文字](実際のファイル名)` という書き方で、クリックできるリンクが作られます。

4.  **配布ファイルの添付**
    -   テキストエリアの下にある **"Attach binaries by dropping them here or selecting them"** と書かれた点線の枠に、以下の**3つのファイル**をドラッグ＆ドロップします。
        1.  **本体アプリのインストーラー:** `X_Grid_v1.1.0_setup.exe`
        2.  **QGISプラグインのzip:** `x_grid_styler.zip`
        3.  **取扱説明書PDF:** `取扱説明書.pdf`

    -   🚨 **【超重要】ファイル名の一致を確認！**
        -   ここで添付するファイル名は、**ステップ3のテンプレートの `()` の中に書いたファイル名と、一字一句同じでなければいけません。**
        -   もしファイル名が違う場合（例: `default.pdf`）、テンプレートの `(取扱説明書.pdf)` の部分を `(default.pdf)` のように、実際に添付するファイル名に書き換えてください。

5.  **最終確認と公開**
    -   緑色の公開ボタンを押す前に、以下の項目を最終チェックしましょう。
        -   [ ] **"Attach binaries..."** の枠の下に、添付したファイル（`exe`, `zip`, `pdf`）がリスト表示されていますか？
        -   [ ] リリースノートのリンクの `()` の中のファイル名と、リスト表示されているファイル名は**完全に一致**していますか？
    -   **(推奨)** `Set as a pre-release` にチェックを入れます。
    -   すべての確認がOKなら、**[Publish release]** ボタンを押して、リリースを公開します。

---

**これで、すべての更新作業は完了です！** 🎉
公開されたページで、ダウンロードリンクが青色に変わり、正しくクリックできることを確認してください。