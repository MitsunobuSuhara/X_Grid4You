# X-Grid & X-Grid Styler

**国有林で使われる「平均集材距離計算表」を、DX化したシステムです。**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

![X-Grid アプリケーションのスクリーンショット](https://raw.githubusercontent.com/MitsunobuSuhara/X_Grid4You/main/images/sample.png) 

`X-Grid`は、スタンドアロンで動作するデスクトップアプリケーションです。伐採区域などのベクターデータを読み込み、地図上で土場を指定するだけで平均集材距離を自動で算出します。計算結果は、計算過程がひと目でわかる図としてPDFに出力できます。

`X-Grid Styler`は、オープンソースGISソフトウェア「QGIS」のプラグインです。QGIS上で作成した地図の見た目（色、線の種類、太さなど）を`X-Grid`アプリに引き継ぐためのスタイル情報を、データに書き出す役割を担います。

---

## ダウンロードとインストール (Download & Installation)

**最新版のインストーラーとプラグインは、以下のリンクからダウンロードできます。**
-   **[>> 最新バージョンのダウンロードページはこちら <<](https://github.com/MitsunobuSuhara/X_Grid4You/releases/latest)**

### 1. X-Grid (本体アプリ)

1.  上のリンクから、最新リリースの `X-Grid_vX.X.X_setup.exe` をダウンロードします。
2.  ダウンロードしたインストーラーを実行し、画面の指示に従ってインストールしてください。
3.  インストールが完了すると、デスクトップやスタートメニューにショートカットが作成されます。

    > **⚠️ <font color="#D32F2F">インストール時の注意点</font>**
    > <font color="#D32F2F">Windowsのセキュリティ機能（Microsoft Defender SmartScreen）により、「WindowsによってPCが保護されました」という画面が表示されることがあります。</font>
    >
    > <font color="#D32F2F">これは、アプリがまだ広く認知されていないために表示される警告であり、危険なファイルではありません。以下の手順でインストールを続行できます。</font>
    >
    > 1.  <font color="#D32F2F">画面の左側にある **[詳細情報]** の文字をクリックします。</font>
    > 2.  <font color="#D32F2F">右下に新しく表示される **[実行]** ボタンをクリックします。</font>
    
### 2. X-Grid Styler (QGIS プラグイン)

1.  上のリンクから、最新リリースの `x_grid_styler.zip` をダウンロードします。
2.  QGISを起動し、メニューから `[プラグイン]` > `[プラグインの管理とインストール]` を開きます。
3.  `[ZIPからインストール]` タブを選択し、ダウンロードした `x_grid_styler.zip` を指定してインストールします。
4.  ツールバーに新しいアイコンが追加されれば成功です。

---

## 主な機能 (Key Features)

### X-Grid
- **簡単操作**: わずか数クリックで平均集材距離を計算。
- **データ読み込み**: シェープファイル (`.shp`) や GeoPackage (`.gpkg`) に対応。
- **直感的なインターフェース**: 地図上で土場及び区域の入口（ゼロ距離地点）を直接クリックして指定。
- **自動レイアウト**: 読み込んだデータの形状に合わせて、用紙サイズ (A4/A3) や地図の向きを自動で最適化。
- **地図の微調整**: **`Ctrl`キーを押しながらドラッグ**することで、地図を自由に移動させ、表示位置を微調整できます。
- **詳細な計算表**: 計算の過程がわかる縦横の度数分布表を自動生成。
- **高品質なPDF出力**: 縮尺 1:5000 の計算図を、いつでも印刷できる形式でエクスポート。

### X-Grid Styler (QGIS プラグイン)
- **スタイルの書き出し**: QGISで設定したベクターレイヤのシンボル情報を、属性データとして簡単に書き出します。
- **見た目の再現**: 書き出したデータを`X-Grid`で読み込むと、QGIS上の見た目（ポリゴンの塗りつぶし色、ラインの色や太さなど）が再現されます。
- **多様なレンダラーに対応**: 単一定義、カテゴリ値による定義、ルールに基づいた定義など、QGISの主要なスタイリング方法に対応。

---

## 使い方

**Step 1: QGISで地図データを準備 (X-Grid Styler)**
1. QGISに林班図や作業道網などのベクターデータを読み込みます。
2. レイヤのスタイルを任意に設定します（例: 作業道の種類で線の種類や色を変えるなど）。
3. QGISプラグイン「X-Grid Styler」を起動し、対象レイヤのスタイルを属性データとして書き出します。
4. スタイルを書き出したレイヤを **GeoPackage (`.gpkg`)** 形式でエクスポートします（シェープファイルも可能ですが、GPKGを推奨）。

**Step 2: 平均集材距離を計算・出力 (X-Grid)**
1. スタンドアロンアプリ「X-Grid」を起動します。
2. `[レイヤ追加]` ボタンもしくは、`[ドラッグ&ドロップ]`で、Step 1でエクスポートしたファイルを追加します。
3. 地図が表示されたら、土場や、伐採区域の入口となるセルをクリックして指定します。
4. `[計算を実行]` ボタンをクリックすると、平均集材距離と計算過程の表が瞬時に表示されます。
    - **ヒント:** `Ctrl`キーを押しながら地図をドラッグすると、PDFに出力する際の表示範囲を調整できます。**地図を動かした場合は再度、土場や伐採区域の入口となるセルをクリックし直してください。**
5. 「林小班名等」を入力し、`[表示]` ボタンで図のタイトルを更新します。
6. `[エクスポート]` ボタンで、最終的な結果をPDFとして保存します。

---

## 入力データに関する重要事項
- **座標系**: データは **平面直角座標系** である必要があります。緯度経度のデータでは正しく計算できません。
- **文字コード**: シェープファイルの属性名（フィールド名）は**10文字以内**にする必要があります。日本語などの2バイト文字が含まれていると、読み込みに失敗することがあります。**GeoPackage (`.gpkg`) 形式で保存**することを強く推奨します。
- **ライン延長の表示**: ラインレイヤの属性に `meter` というフィールド（半角小文字）があると、その値が地図上のラインの横に自動で表示されます（例: `123m`）。

## 技術スタック (Tech Stack)

- **X-Grid**: Python, PyQt6, Fiona, Shapely
- **X-Grid Styler**: Python, PyQGIS API
- **Installer**: Inno Setup

## ライセンス (License)

このプロジェクトはMITライセンスの下で公開されています。詳細は `LICENSE` ファイルをご覧ください。

## 免責事項 (Disclaimer)

本ソフトウェアの使用によって生じたいかなる損害についても、開発者は一切の責任を負いません。計算結果は、業務上の判断を補助するための参考値としてご利用ください。

## 作者 (Author)

- Mitsunobu Suhara + Google AI Studio
