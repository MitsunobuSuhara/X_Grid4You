=================================================================
=                                                               =
=              「X_Grid」 ご利用ガイド (かんたん起動版)             =
=                                                               =
=================================================================

このガイドでは、平均集材距離計算システム「X_Grid」を使うための準備から、
基本的な操作、QGISと連携した便利な使い方までを分かりやすく説明します。

この「かんたん起動版」は、面倒なインストール作業は一切不要です！


-----------------------------------------------------------------
 Part 1: 準備編 - はじめる前に -
-----------------------------------------------------------------

### 1. 必要なものリスト

+----------------------+-------------------------------------------------+
| 必要なもの           | 説明                                            |
+----------------------+-------------------------------------------------+
| 対応OS               | Windows 10, Windows 11                          |
+----------------------+-------------------------------------------------+
| 本プログラム一式     | ダウンロードしたZIPファイルに含まれる一式です。 |
| (ZIPファイル)        |  ・`X-Gridアプリケーション` フォルダ            |
|                      |  ・`x_grid_styler.zip` (QGIS連携プラグイン)     |
|                      |  ・このご利用ガイド                             |
+----------------------+-------------------------------------------------+
| 地図データファイル   | 計算したい森林の範囲などが入った地図データです。|
|                      |  ・ファイル形式:                                |
|                      |    GeoPackage (.gpkg), Shapefile (.shp)         |
|                      |  ・【重要】:                                    |
|                      |    データは「平面直角座標系」で作成されている   |
|                      |    必要があります。                             |
+----------------------+-------------------------------------------------+
| QGIS (任意)          | 地図データを作成・編集する場合に便利です。      |
|                      | スタイルの設定にも使います。                    |
+----------------------+-------------------------------------------------+

    【用語解説】
      * 平面直角座標系: 日本の各地域を、歪みが少なくなるように平面として
        扱うための座標系です。正確な距離や面積の計算に不可欠です。


### 2. 準備の手順 (かんたん2ステップ！)

#### ステップ1: ZIPファイルの解凍

  ダウンロードしたZIPファイルを右クリックし、「すべて展開」または
  「ここに展開」を選んで、フォルダをデスクトップなどの分かりやすい
  場所に取り出してください。

#### ステップ2: 起動の確認

  1. 展開してできた `X-Grid_配布セット` フォルダを開きます。
  2. 中にある `X-Gridアプリケーション` フォルダを開きます。
  3. アプリアイコンの付いた「`X_Grid.exe`」をダブルクリックします。

  「X_Grid - 平均集材距離計算システム」というウィンドウが表示されれば準備完了です！

  ※初回起動時にWindowsのセキュリティ警告が出ることがありますが、
    「詳細情報」→「実行」を選択してください。


-----------------------------------------------------------------
 Part 2: 基本操作編 - 計算してみよう -
-----------------------------------------------------------------

準備が整ったら、いよいよ `X_Grid` を操作します。

### 操作手順

左側のパネルの指示に従って操作します。

  1. レイヤ追加:
     [レイヤ追加]ボタンから、地図データ(.gpkg または .shp)を選択します。
     ※ベクタファイルの属性データが文字化けしていると、読み込みに失敗します。
       
     読み込まれたレイヤが左の「レイヤ管理」リストに表示されます。

  2. 計算対象の指定:
     レイヤ管理リストで、計算対象にしたい区域(ポリゴン)のレイヤに
     チェックを入れます。チェックされたすべてのポリゴンレイヤが
     合算されて計算対象になります。

       【TIPS】
         区域（ポリゴン）のレイヤは、読み込み時に自動でチェックが
         入った状態になります。計算に含めたくない区域はチェックを
         外してください。

  3. 土場（区域の入口）の指定:
     地図上で、計算の基準点となる場所（土場や伐採区域の入口など）を
     クリックします。クリックした場所に赤い丸が表示されます。

  4. 計算の実行:
     [計算を実行]ボタンをクリックします。平均集材距離が自動で計算され、
     地図の周囲に詳細な計算表が表示されます。

  5. 見出し入力とエクスポート:
     a. 見出し（例：77い林小班、〇〇伐区 等）を入力欄に入力し、
        隣の[表示]ボタンを押すと、図面のタイトルが更新されます。
     b. [エクスポート]ボタンを押すと、表示されている図面全体を
        PDFまたはPNGファイルとして保存できます。

       【TIPS】
         PDFは、印刷時に「実際のサイズ」や「倍率100%」に設定すると、
         1/5000の縮尺通りに印刷できます。


-----------------------------------------------------------------
 Part 3: 応用編 - もっと便利に使う -
-----------------------------------------------------------------

### 1. 微調整のテクニック

  * 地図の表示位置をずらしたい時:
    `Ctrl`キーを押しながら地図をドラッグすると、表示位置を自由に
    調整できます。

    【注意】
      地図を移動させると、グリッドと地図の位置関係が変わります。
      移動後は、必ず再度「基準点の指定(クリック)」と「計算を実行」
      をやり直してください。

### 2. スタイルを思い通りに表示する（QGIS連携）

QGISで設定したスタイル（色や線の種類）を `X_Grid` で再現するには、
付属のQGISプラグイン「X_Grid Styler」を使います。

  1. QGISでプラグインをインストール:
     配布セットの中にある `x_grid_styler.zip` を使います。
     QGISメニュー > プラグイン > 管理とインストール >
     「zipからインストール」でこのファイルを選択します。

  2. QGISで地図をスタイリング:
     QGIS上で、林班や作業道の色、線の太さ、破線などを自由に設定します。

  3. プラグインを実行し、スタイルを書き出す:
     ツールバーに追加されたアイコンや、「プラグイン」メニューから
     「X-Grid用スタイルを書き出し」を選択します。
     ダイアログで対象レイヤを選び、[書き出し]ボタンを押します。
     → レイヤの属性テーブルにスタイル情報が書き込まれます。
     （重要：変更を上書き保存してください！）
 
  4. X_Gridで読み込む:
     上記で保存したファイルを `X_Grid` で読み込むと、属性に
     書き込まれたスタイルが適用され、QGISでの見た目に近い表示になります。

    【TIPS】延長表示機能
      ラインレイヤの属性に「meter」(半角小文字)という名前の
      フィールドを作り数値を入力しておくと、X_Gridで読み込んだ際に、
      その値がラインの横に自動表示されます。(例: 123m)


-----------------------------------------------------------------
 Part 4: 困ったときは (Q&A)
-----------------------------------------------------------------

Q1. レイヤファイルが読み込めない、エラーが出る。

A1. 以下の2点を確認してください。
    1. 座標系は「平面直角座標系」になっていますか？ 緯度経度のデータ
       (JGD2000, JGD2011など)は直接使用できません。
    2. 属性のフィールド名（列名）が文字化けしていませんか？
       文字化けしていると読み込みに失敗することがあります。
       QGISなどでフィールド名を半角英数に変更するか、属性自体を削除してください。


Q2. 「計算を実行」ボタンを押しても何も起こらない、または警告が出る。

A2. 以下の2点を確認してください。
    1. 「基準点」を指定しましたか？ 地図上をクリックして赤い丸を表示させて
       ください。
    2. 計算対象となる区域（ポリゴン）レイヤにチェックが入っていますか？
       リストで最低1つのポリゴンレイヤがチェックされている必要が
       あります。

Q3. 地図が勝手に回転したり、用紙サイズが変わったりする。

A3. これはエラーではありません。読み込んだデータの形に合わせて、図面に
    きれいに収まるようにプログラムが自動でレイアウトを調整する仕様です。
    以下の優先順位で、最適な表示方法を自動で選択します。
    1. A4縦 (回転なし)  → 2. A4縦 (90度回転) → 3. A4縦 (最適回転)
    4. A3横 (回転なし)  → 5. A3横 (90度回転) → 6. A3横 (最適回転)

Q4. 「A3モードでも最適な回転が見つかりませんでした」という警告が出る。

A4. 読み込んだデータの範囲が非常に大きい、または特殊な形状であることを
    示しています。そのまま表示・計算はできますが、図面の一部が切れて
    しまう可能性があります。より正確に作成するには、元データをQGISなどで
    分割してから再度読み込んでください。

Q5. QGISで設定したスタイルがX_Gridで反映されない。

A5. 以下の2点を確認してください。
    1. QGISで「X_Grid Styler」プラグインを実行しましたか？
    2. プラグイン実行後、そのレイヤを【上書き保存】または
       【名前を付けて保存】しましたか？ スタイルを書き出しただけでは
       ファイルには反映されません。保存したファイルをX_Gridで
       読み込む必要があります。

Q6. エクスポートしたPNGファイルを、1/5000の縮尺で印刷できますか？

A6. いいえ、PNGファイルはPDFと異なり、正確な縮尺で印刷することは
    できません。これは、PNGが画面上で見るための「画像」であり、PDFが
    物理的な大きさの情報を持つ「書類」という根本的な違いがあるためです。
    
    ・PDF: 【縮尺通りに印刷したい場合】
      役所に提出する図面や、現場でスケールを当てて使う地図など。
      
    ・PNG: 【図として使いたい場合】
      WordやPowerPointの報告書への貼り付け、メールでの共有など。

=================================================================